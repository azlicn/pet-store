import{a as g}from"./chunk-OWSNC4QG.js";import{a as oe,b as ne}from"./chunk-2K4IJOUG.js";import{a as de}from"./chunk-7XBR4NAU.js";import{a as k}from"./chunk-XGWPAENB.js";import{a as ae,b as me}from"./chunk-D6YOMAUJ.js";import{a as le,b as se}from"./chunk-5ZXECSJE.js";import{c as re}from"./chunk-PUKFZD22.js";import"./chunk-OVUCDZ47.js";import{a as A}from"./chunk-JBPC4PL7.js";import"./chunk-EY6RNGL4.js";import{a as R,b as f,d as $,e as H,h as Y,i as z,j as J,k as K,m as Q,o as W,p as X,q as Z,s as ee,w as te,x as ie}from"./chunk-IVESP2IG.js";import{a as B,b as O,c as w,e as U,f as D,g as j}from"./chunk-CWIOIJCP.js";import{a as F,c as T}from"./chunk-NWH3GCAN.js";import{$ as L,W as N,ba as q,ca as V,da as G}from"./chunk-ORF7SHNW.js";import"./chunk-Q64FFBLU.js";import{Ac as M,Bc as y,Fb as C,Fc as b,Hb as x,Pb as o,Qb as P,Rb as S,Va as l,Wa as d,Xb as I,ia as E,lb as c,nb as s,wb as r,xb as i,yb as u}from"./chunk-4EBM5WXH.js";function pe(a,p){a&1&&(r(0,"mat-error"),o(1," Pet name is required "),i())}function ce(a,p){if(a&1&&(r(0,"mat-option",17),o(1),i()),a&2){let e=p.$implicit;s("value",e.id),l(),S(" ",e.name," ")}}function ue(a,p){a&1&&(r(0,"mat-error"),o(1," Category is required "),i())}function fe(a,p){a&1&&(r(0,"mat-error"),o(1," Price is required "),i())}function ge(a,p){a&1&&(r(0,"mat-error"),o(1," Price must be positive "),i())}function he(a,p){a&1&&(r(0,"mat-form-field",6)(1,"mat-label"),o(2,"Status"),i(),r(3,"mat-select",18)(4,"mat-option",19),o(5,"Available"),i(),r(6,"mat-option",20),o(7,"Pending"),i(),r(8,"mat-option",21),o(9,"Sold"),i()()())}function ve(a,p){if(a&1&&(r(0,"mat-form-field",6)(1,"mat-label"),o(2,"Status"),i(),u(3,"input",22),i()),a&2){let e,t=x();l(3),s("value",t.getStatusDisplayText((e=t.petForm.get("status"))==null?null:e.value))}}var $e=(()=>{class a{constructor(e,t,n,m,h,v,_){this.fb=e,this.petService=t,this.categoryService=n,this.route=m,this.router=h,this.snackBar=v,this.authService=_,this.isEdit=!1,this.petId=null,this.categories=[],this.petForm=this.fb.group({name:["",[f.required]],categoryId:["",[f.required]],price:["",[f.required,f.min(0)]],status:[g.AVAILABLE],photoUrlsText:[""],tagsText:[""]})}ngOnInit(){this.loadCategories();let e=this.route.snapshot.paramMap.get("id");e&&(this.isEdit=!0,this.petId=+e,this.loadPet(this.petId))}loadCategories(){this.categoryService.getAllCategories().subscribe({next:e=>{this.categories=e},error:e=>{this.snackBar.open("Error loading categories","Close",{duration:3e3}),console.error("Error loading categories:",e)}})}loadPet(e){this.petService.getPetById(e).subscribe({next:t=>{if(!this.canEditPet(t)){this.snackBar.open("You do not have permission to edit this pet","Close",{duration:3e3}),this.router.navigate(["/pets"]);return}this.petForm.patchValue({name:t.name,categoryId:t.category?.id,price:t.price,status:t.status,photoUrlsText:t.photoUrls?t.photoUrls.join(`
`):"",tagsText:t.tags?t.tags.join(", "):""})},error:t=>{this.snackBar.open("Error loading pet","Close",{duration:3e3}),console.error("Error loading pet:",t),this.router.navigate(["/pets"])}})}canEditPet(e){if(this.authService.isAdmin())return!0;let t=this.authService.getCurrentUser();return t?e.createdBy===t.id:!1}isAdmin(){return this.authService.isAdmin()}getStatusDisplayText(e){switch(e){case g.AVAILABLE:return"Available";case g.PENDING:return"Pending";case g.SOLD:return"Sold";default:return e}}onSubmit(){if(this.petForm.valid){let e=this.petForm.value,t=this.categories.find(m=>m.id===e.categoryId);if(!t){this.snackBar.open("Please select a valid category","Close",{duration:3e3});return}let n={name:e.name,category:t,price:+e.price,status:e.status,photoUrls:this.parsePhotoUrls(e.photoUrlsText),tags:this.parseTags(e.tagsText)};this.isEdit&&this.petId?(console.log("Auth Debug Info:"),console.log("Is logged in:",this.authService.isLoggedIn()),console.log("Current user:",this.authService.getCurrentUser()),console.log("Token exists:",!!this.authService.getToken()),console.log("Token preview:",this.authService.getToken()?.substring(0,50)+"..."),console.log("Full token for verification:",this.authService.getToken()),this.petService.updatePet(this.petId,n).subscribe({next:()=>{this.snackBar.open("Pet updated successfully","Close",{duration:2e3}),this.router.navigate(["/pets"])},error:m=>{console.error("Full error object:",m),this.snackBar.open("Error updating pet","Close",{duration:3e3}),console.error("Error updating pet:",m)}})):this.petService.addPet(n).subscribe({next:()=>{this.snackBar.open("Pet added successfully","Close",{duration:2e3}),this.router.navigate(["/pets"])},error:m=>{this.snackBar.open("Error adding pet","Close",{duration:3e3}),console.error("Error adding pet:",m)}})}}onCancel(){this.router.navigate(["/pets"])}parsePhotoUrls(e){if(e.trim())return e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0)}parseTags(e){if(e.trim())return e.split(",").map(t=>t.trim()).filter(t=>t.length>0)}static{this.\u0275fac=function(t){return new(t||a)(d(Q),d(k),d(de),d(F),d(T),d(le),d(A))}}static{this.\u0275cmp=E({type:a,selectors:[["app-pet-form"]],standalone:!0,features:[I],decls:50,vars:11,consts:[[1,"pet-form-container"],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Enter pet name"],[4,"ngIf"],["appearance","outline"],["formControlName","categoryId"],[3,"value",4,"ngFor","ngForOf"],["matPrefix",""],["matInput","","type","number","formControlName","price","placeholder","Price in USD"],["appearance","outline",4,"ngIf"],["matInput","","formControlName","photoUrlsText","placeholder","https://example.com/photo1.jpg","rows","3"],["matInput","","formControlName","tagsText","placeholder","friendly, trained, vaccinated"],["align","end"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-flat-button","",3,"click"],[3,"value"],["formControlName","status"],["value","AVAILABLE"],["value","PENDING"],["value","SOLD"],["matInput","","readonly","",3,"value"]],template:function(t,n){if(t&1&&(r(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),o(4),i()(),r(5,"mat-card-content")(6,"form",1),C("ngSubmit",function(){return n.onSubmit()}),r(7,"div",2)(8,"mat-form-field",3)(9,"mat-label"),o(10,"Pet Name"),i(),u(11,"input",4),c(12,pe,2,0,"mat-error",5),i()(),r(13,"div",2)(14,"mat-form-field",6)(15,"mat-label"),o(16,"Category"),i(),r(17,"mat-select",7),c(18,ce,2,2,"mat-option",8),i(),c(19,ue,2,0,"mat-error",5),i(),r(20,"mat-form-field",6)(21,"mat-label"),o(22,"Price"),i(),r(23,"span",9),o(24,"\xA0\xA0$"),i(),u(25,"input",10),c(26,fe,2,0,"mat-error",5)(27,ge,2,0,"mat-error",5),i()(),r(28,"div",2),c(29,he,10,0,"mat-form-field",11)(30,ve,4,1,"mat-form-field",11),i(),r(31,"div",2)(32,"mat-form-field",3)(33,"mat-label"),o(34,"Photo URLs (one per line)"),i(),u(35,"textarea",12),i()(),r(36,"div",2)(37,"mat-form-field",3)(38,"mat-label"),o(39,"Tags (comma separated)"),i(),u(40,"input",13),i()()()(),r(41,"mat-card-actions",14)(42,"button",15),C("click",function(){return n.onSubmit()}),r(43,"mat-icon"),o(44,"save"),i(),o(45),i(),r(46,"button",16),C("click",function(){return n.onCancel()}),r(47,"mat-icon"),o(48,"cancel"),i(),o(49," Cancel "),i()()()()),t&2){let m,h,v,_;l(4),P(n.isEdit?"Edit Pet":"Add New Pet"),l(2),s("formGroup",n.petForm),l(6),s("ngIf",(m=n.petForm.get("name"))==null?null:m.hasError("required")),l(6),s("ngForOf",n.categories),l(),s("ngIf",(h=n.petForm.get("categoryId"))==null?null:h.hasError("required")),l(7),s("ngIf",(v=n.petForm.get("price"))==null?null:v.hasError("required")),l(),s("ngIf",(_=n.petForm.get("price"))==null?null:_.hasError("min")),l(2),s("ngIf",!n.isEdit||n.isAdmin()),l(),s("ngIf",n.isEdit&&!n.isAdmin()),l(12),s("disabled",!n.petForm.valid),l(3),S(" ",n.isEdit?"Update Pet":"Add Pet"," ")}},dependencies:[b,M,y,W,Y,R,z,$,H,J,K,ie,te,X,Z,ee,me,ae,ne,oe,N,q,L,j,B,U,w,D,O,re,G,V,se],styles:[".pet-form-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.full-width[_ngcontent-%COMP%]{width:100%}mat-card-actions[_ngcontent-%COMP%]{display:flex;gap:12px;padding:16px}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{min-height:56px;padding-top:16px;padding-bottom:16px}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-text-prefix[_ngcontent-%COMP%]{padding-right:4px;color:#0009;font-weight:400;display:flex;align-items:center}[matPrefix][_ngcontent-%COMP%]{padding-right:4px;color:#0009;font-weight:400;display:inline-flex;align-items:center;white-space:nowrap}"]})}}return a})();export{$e as PetFormComponent};
