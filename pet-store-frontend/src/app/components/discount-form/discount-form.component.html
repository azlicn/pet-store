<div class="discount-form-container">
  <mat-card class="discount-form-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
        {{ isEditMode ? 'Edit Discount' : 'Create New Discount' }}
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading discount...</p>
      </div>

      <form *ngIf="!loading" [formGroup]="discountForm" (ngSubmit)="onSubmit()" class="discount-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Discount Code</mat-label>
          <input
            matInput
            formControlName="code"
            placeholder="Enter discount code"
            maxlength="20"
            (input)="onCodeInput($event)">
          <mat-hint align="end">{{ code?.value?.length || 0 }}/20</mat-hint>
          <mat-error *ngIf="code?.invalid && code?.touched">
            {{ getErrorMessage('code') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description" maxlength="200" placeholder="Enter description"></textarea>
           <mat-hint align="end">{{ description?.value?.length || 0 }}/200</mat-hint>
          <mat-error *ngIf="description?.invalid && description?.touched">
            {{ getErrorMessage('description') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Percentage</mat-label>
          <input matInput type="number" formControlName="percentage" min="1" max="100" placeholder="Discount percentage">
          <mat-error *ngIf="discountForm.get('percentage')?.invalid && discountForm.get('percentage')?.touched">
            Enter a valid percentage (1-100).
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Valid From</mat-label>
          <input matInput [matDatepicker]="validFromPicker" formControlName="validFrom" placeholder="Choose a start date">
          <mat-datepicker-toggle matSuffix [for]="validFromPicker"></mat-datepicker-toggle>
          <mat-datepicker #validFromPicker></mat-datepicker>
          <mat-error *ngIf="discountForm.get('validFrom')?.invalid && discountForm.get('validFrom')?.touched">
            Valid From date is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Valid To</mat-label>
          <input matInput [matDatepicker]="validToPicker" formControlName="validTo" placeholder="Choose an end date">
          <mat-datepicker-toggle matSuffix [for]="validToPicker"></mat-datepicker-toggle>
          <mat-datepicker #validToPicker></mat-datepicker>
          <mat-error *ngIf="discountForm.get('validTo')?.invalid && discountForm.get('validTo')?.touched">
            Valid To date is required.
          </mat-error>
        </mat-form-field>

        <mat-checkbox formControlName="active" class="active-checkbox">Active</mat-checkbox>

        <mat-error *ngIf="discountForm.hasError('dateRange')">
          {{ discountForm.getError('dateRange') }}
        </mat-error>

        <div class="form-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="discountForm.invalid || submitting"
            class="submit-button">
            <mat-icon *ngIf="!submitting">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
            <mat-spinner *ngIf="submitting" diameter="20"></mat-spinner>
            {{ submitting ? 'Saving...' : (isEditMode ? 'Update Discount' : 'Create Discount') }}
          </button>

          <button
            mat-button
            type="button"
            (click)="onCancel()"
            [disabled]="submitting"
            class="cancel-button">
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>

<!-- 
<div class="discount-form">
  <h2>{{ isEdit ? 'Edit Discount' : 'Create Discount' }}</h2>
  <form [formGroup]="discountForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="code">Code</label>
      <input id="code" formControlName="code" class="form-control" />
      <div *ngIf="discountForm.get('code')?.invalid && discountForm.get('code')?.touched" class="text-danger">
        Code is required.
      </div>
    </div>
    <div class="form-group">
      <label for="description">Description</label>
      <textarea id="description" formControlName="description" class="form-control"></textarea>
    </div>
    <div class="form-group">
      <label for="percentage">Percentage</label>
      <input id="percentage" type="number" formControlName="percentage" class="form-control" min="1" max="100" />
      <div *ngIf="discountForm.get('percentage')?.invalid && discountForm.get('percentage')?.touched" class="text-danger">
        Enter a valid percentage (1-100).
      </div>
    </div>
    <div class="form-group">
      <label for="validFrom">Valid From</label>
      <input id="validFrom" type="date" formControlName="validFrom" class="form-control" />
      <div *ngIf="discountForm.get('validFrom')?.invalid && discountForm.get('validFrom')?.touched" class="text-danger">
        Valid From date is required.
      </div>
    </div>
    <div class="form-group">
      <label for="validTo">Valid To</label>
      <input id="validTo" type="date" formControlName="validTo" class="form-control" />
      <div *ngIf="discountForm.get('validTo')?.invalid && discountForm.get('validTo')?.touched" class="text-danger">
        Valid To date is required.
      </div>
    </div>
    <div class="form-group">
      <label>
        <input type="checkbox" formControlName="active" /> Active
      </label>
    </div>
    <button type="submit" class="btn btn-primary" [disabled]="discountForm.invalid">
      {{ isEdit ? 'Update' : 'Create' }} Discount
    </button>
    <button type="button" class="btn btn-secondary" routerLink="/discounts">Cancel</button>
  </form>
</div> -->
